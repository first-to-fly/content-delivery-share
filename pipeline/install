#!/usr/bin/env bash

# shellcheck source=./lib/bash/core.sh
source "${BASH_SOURCE[0]%/*}/../lib/bash/core.sh"

# shellcheck source=./lib/bash/node.sh
source "${BASH_SOURCE[0]%/*}/../lib/bash/node.sh"

function main() {

  local PRODUCTION="false"
  if [[ "$*" == *"--production"* ]]; then
    PRODUCTION="true"
  fi

  echo -e "${OK_COLOR}==> Installing dependencies..."

  (
    set -x
    npm install --global "npm@7.17.0"
    npm --version
  )

  NPM="$(command -v npm)"

  (
    set -x
    # "--force" accepts dependency conflict
    "${NPM}" install \
      --force \
      "$@"
  )

  if [[ "${PRODUCTION}" != "true" ]]; then
    (
      set -x
      "${NPM}" audit || true
    )
  fi

}

main "$@"
