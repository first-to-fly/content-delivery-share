#!/usr/bin/env bash

# shellcheck source=./lib/bash/core.sh
source "${BASH_SOURCE[0]%/*}/../lib/bash/core.sh"

# shellcheck source=./lib/bash/node.sh
source "${BASH_SOURCE[0]%/*}/../lib/bash/node.sh"

function main() {

  local PRODUCTION=""
  if [[ "$*" == *"--production"* ]]; then
    PRODUCTION="true"
  fi

  echo -e "${OK_COLOR}==> Installing dependencies..."

  NPM="$(command -v npm)"

  (
    set -x
    "${NPM}" --version
    "${NPM}" install --global "npm@latest"
    "${NPM}" --version
  )

  (
    set -x
    "${NPM}" install \
      "$@"
  )

  if [[ -z "${PRODUCTION}" ]]; then
    (
      set -x
      "${NPM}" audit fix --force
    )
  fi

}

main "$@"
